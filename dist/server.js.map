{"version":3,"sources":["../server/server.js"],"names":["require","config","mongoose","port","process","env","PORT","SourceMapSupport","install","connect","DBPASSWORD","useNewUrlParser","useUnifiedTopology","then","server","app","listen","console","log","setTimeout","catch","error","use","express","static","bodyParser","json","urlencoded","extended","name","keys","passport","initialize","session","isLoggedIn","req","res","next","status","message","isAuthorized","houseHold","owner","user","_id","post","User","findById","household","APIKEY","method","headers","accessToken","body","JSON","stringify","houseName","response","ok","queryFilter","googleID","findOne","HouseHold","create","calendarID","id","members","newHousehold","updateOne","send","err","get","house","delete","updatedGroups","groups","filter","group","index","Index","eventBody","push","newGroup","messageBody","postedBy","Message","newMessage","dir","To","transporter","nodemailer","createTransport","service","auth","MAILUSER","pass","MAILPASS","mailOptions","from","to","subject","html","firstName","lastName","sendMail","data","resObject","find","messages","params","houseID","patch","updatedMembers","updatedChores","chores","Chore","Promise","all","promisesArray","values","deleteOne","updateMany","deleteMany","returnTo","query","state","Buffer","toString","undefined","authenticator","authenticate","scope","logout","redirect","failureRedirect","startsWith","sendFile","path","resolve"],"mappings":";;AAAA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;;;AACAA,QAAQ,QAAR,EAAkBC,MAAlB;AACAD,QAAQ,mBAAR;AACA,IAAME,WAAWF,QAAQ,UAAR,CAAjB;;AAEA,IAAIG,OAAOC,QAAQC,GAAR,CAAYC,IAAZ,IAAoB,IAA/B;AACA;AACAC,2BAAiBC,OAAjB;AACA;AACAN,SAASO,OAAT,8BAA4CL,QAAQC,GAAR,CAAYK,UAAxD,+EAA6I,EAAEC,iBAAiB,IAAnB,EAAyBC,oBAAoB,IAA7C,EAA7I,EACCC,IADD,CACM,sBACF;AACI,QAAIC,SAASC,IAAIC,MAAJ,CAAWb,IAAX,EAAiB,YAC9B;AACIc,gBAAQC,GAAR,0BAAmCf,IAAnC;AACAc,gBAAQC,GAAR,CAAY,iCAAZ;AACH,KAJY,CAAb;;AAMAJ,WAAOK,UAAP,CAAkB,MAAlB;AACH,CAVL,EAWCC,KAXD,CAWO,iBACH;AACIH,YAAQC,GAAR,CAAY,wBAAZ,EAAsCG,KAAtC;AACH,CAdL;AAeA,IAAMN,MAAM,wBAAZ;AACA;;AAEAA,IAAIO,GAAJ,CAAQC,kBAAQC,MAAR,CAAe,QAAf,CAAR;AACAT,IAAIO,GAAJ,CAAQG,qBAAWC,IAAX,EAAR;AACAX,IAAIO,GAAJ,CAAQG,qBAAWE,UAAX,CAAsB,EAACC,UAAS,KAAV,EAAtB,CAAR;AACAb,IAAIO,GAAJ,CAAQ,6BAAc;AAClBO,UAAK,gBADa;AAElBC,UAAK,CAAC,MAAD,EAAQ,MAAR;AAFa,CAAd,CAAR;AAIAf,IAAIO,GAAJ,CAAQS,mBAASC,UAAT,EAAR;AACAjB,IAAIO,GAAJ,CAAQS,mBAASE,OAAT,EAAR;;AAGA;AACA,IAAMC,aAAa,SAAbA,UAAa,CAACC,GAAD,EAAKC,GAAL,EAASC,IAAT,EACnB;AACI,QAAGF,IAAIF,OAAJ,CAAYF,QAAf,EACA;AACIM;AACH,KAHD,MAKA;AACID,YAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS,0CAAV,EAArB;AACH;AACJ,CAVD;;AAYA,IAAMC,eAAe,SAAfA,YAAe,CAACC,SAAD,EACrB;AACI,QAAGA,UAAUC,KAAV,KAAoBP,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BC,GAAtD,EACA;AACI,eAAO,IAAP;AACH,KAHD,MAKA;AACI,eAAO,KAAP;AACH;AACJ,CAVD;;AAYA7B,IAAI8B,IAAJ,CAAS,oBAAT,EAA+BX,UAA/B,EAA2C,UAACC,GAAD,EAAKC,GAAL,EAC3C;AACIU,mBAAKC,QAAL,CAAcZ,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BC,GAA7C,EAAkD/B,IAAlD,CAAuD,gBACvD;AACI,YAAG8B,KAAKK,SAAR,EACA;AACIZ,gBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS,gEAAV,EAArB;AACH,SAHD,MAMA;AACI,+FAA8DnC,QAAQC,GAAR,CAAY4C,MAA1E,EAAoF;AAChFC,wBAAO,MADyE;AAEhFC,yBAAQ,EAAC,6BAA0BhB,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BS,WAArD,EAAoE,UAAS,kBAA7E,EAAgG,gBAAe,kBAA/G,EAFwE;AAGhFC,sBAAKC,KAAKC,SAAL,CAAe,EAAC,WAAUpB,IAAIkB,IAAJ,CAASG,SAApB,EAAf;AAH2E,aAApF,EAKC3C,IALD,CAKM,oBACN;AACI,oBAAG4C,SAASC,EAAZ,EACA;AACID,6BAAS/B,IAAT,GAAgBb,IAAhB,CAAqB,mBACrB;AACI,4BAAM8C,cAAc,EAACC,UAAUzB,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BiB,QAA1C,EAApB;AACAd,uCAAKe,OAAL,CAAaF,WAAb,EAA0B9C,IAA1B,CAA+B,gBAC/B;AACIiD,gDAAUC,MAAV,CAAiB;AACbP,2CAAWF,KAAKC,SAAL,CAAepB,IAAIkB,IAAJ,CAASG,SAAxB,CADE;AAEbQ,4CAAYzB,QAAQ0B,EAFP;AAGbvB,uCAAOC,KAAKC,GAHC;AAIbsB,yCAAS,CAACvB,IAAD;AAJI,6BAAjB,EAMC9B,IAND,CAMM,wBACN;AACIsB,oCAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BK,SAA/B,GAA2CmB,aAAavB,GAAxD;AACAE,+CAAKsB,SAAL,CAAeT,WAAf,EAA4B,EAACX,WAAUmB,aAAavB,GAAxB,EAA5B,EAA0D/B,IAA1D,CAA+D,kBAC/D;AACIuB,wCAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAAEa,SAAS4B,YAAX,EAArB;AACH,iCAHD;AAKH,6BAdD;AAeH,yBAjBD;AAkBH,qBArBD;AAsBH,iBAxBD,MA0BA;AACI/B,wBAAIE,MAAJ,CAAW,GAAX,EAAgB+B,IAAhB,CAAqB,EAAC9B,SAAS,8BAAV,EAArB;AACH;AACJ,aApCD,EAqCCnB,KArCD,CAqCO,eACP;AACIgB,oBAAIE,MAAJ,CAAW,GAAX,EAAgB+B,IAAhB,CAAqBC,GAArB;AACH,aAxCD;AAyCH;AACJ,KAnDD;AAoDH,CAtDD;;AAwDAvD,IAAIwD,GAAJ,CAAQ,2BAAR,EAAqCrC,UAArC,EAAiD,UAACC,GAAD,EAAKC,GAAL,EACjD;AACI0B,wBAAUf,QAAV,CAAmBZ,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BK,SAAlD,EAA6DnC,IAA7D,CAAkE,iBAClE;AACI,uFAA0D2D,MAAMR,UAAhE,iBAAsF5D,QAAQC,GAAR,CAAY4C,MAAlG,EACA;AACIC,oBAAO,MADX;AAEIC,qBAAQ,EAAC,6BAA0BhB,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BS,WAArD,EAAoE,UAAS,kBAA7E,EAAgG,gBAAe,kBAA/G,EAFZ;AAGIC,kBAAKC,KAAKC,SAAL,CAAe,EAAC,QAAO,QAAR,EAAiB,SAAQ,EAAC,QAAO,SAAR,EAAzB,EAAf;AAHT,SADA,EAMC1C,IAND,CAMM,oBACN;AACI,gBAAG4C,SAASC,EAAZ,EACA;AACItB,oBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS,SAAV,EAArB;AACH,aAHD,MAKA;AACIH,oBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS,gCAAV,EAArB;AACH;AACJ,SAhBD,EAiBCnB,KAjBD,CAiBO,eACP;AACIgB,gBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS+B,GAAV,EAArB;AACH,SApBD;AAqBH,KAvBD;AAwBH,CA1BD;;AA4BAvD,IAAI0D,MAAJ,CAAW,0BAAX,EAAuCvC,UAAvC,EAAmD,UAACC,GAAD,EAAMC,GAAN,EACnD;AACIU,mBAAKC,QAAL,CAAcZ,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BC,GAA7C,EAAkD/B,IAAlD,CAAwD,gBACxD;AACIiD,4BAAUf,QAAV,CAAmBJ,KAAKK,SAAxB,EAAmCnC,IAAnC,CAAwC,iBAExC;AACI,gBAAI6D,gBAAgBF,MAAMG,MAA1B;AACAD,0BAAcE,MAAd,CAAsB,UAAEC,KAAF,EAASC,KAAT;AAAA,uBAAoBA,SAAS3C,IAAIkB,IAAJ,CAAS0B,KAAtC;AAAA,aAAtB;AACAjB,gCAAUM,SAAV,CAAqB,EAAExB,KAAK4B,MAAM5B,GAAb,EAArB,EAAwC,EAAxC;AACH,SAND;AAOH,KATD;AAUH,CAZD;;AAcA7B,IAAI8B,IAAJ,CAAS,gBAAT,EAA2BX,UAA3B,EAAuC,UAACC,GAAD,EAAKC,GAAL,EACvC;AACI0B,wBAAUf,QAAV,CAAmBZ,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BK,SAAlD,EAA6DnC,IAA7D,CAAkE,iBAClE;AACI,uFAA0D2D,MAAMR,UAAhE,oBAAyF5D,QAAQC,GAAR,CAAY4C,MAArG,EAA+G;AAC3GC,oBAAO,MADoG;AAE3GC,qBAAQ,EAAC,6BAA0BhB,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BS,WAArD,EAAoE,UAAS,kBAA7E,EAAgG,gBAAe,kBAA/G,EAFmG;AAG3GC,kBAAKC,KAAKC,SAAL,CAAepB,IAAIkB,IAAJ,CAAS2B,SAAxB;AAHsG,SAA/G,EAKCnE,IALD,CAKM,oBACN;AACI,gBAAG4C,SAASC,EAAZ,EACA;AACID,yBAAS/B,IAAT,GAAgBb,IAAhB,CAAqB,mBACrB;AACIuB,wBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAAC,WAAUa,OAAX,EAArB;AACH,iBAHD;AAKH,aAPD,MASA;AACIH,oBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAQkB,SAASJ,IAAlB,EAArB;AACH;AACJ,SAnBD,EAoBCjC,KApBD,CAoBO,eACP;AACIgB,gBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS+B,GAAV,EAArB;AACH,SAvBD;AAwBH,KA1BD;AA2BH,CA7BD;;AA+BAvD,IAAI8B,IAAJ,CAAS,2BAAT,EAAsCX,UAAtC,EAAkD,UAACC,GAAD,EAAKC,GAAL,EAClD;AACIU,mBAAKC,QAAL,CAAcZ,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BC,GAA7C,EAAkD/B,IAAlD,CAAuD,gBACvD;AACIiD,4BAAUf,QAAV,CAAmBJ,KAAKK,SAAxB,EAAmCnC,IAAnC,CAAwC,iBACxC;AACI,gBAAI6D,gBAAgBF,MAAMG,MAA1B;AACAD,0BAAcO,IAAd,CAAmB9C,IAAIkB,IAAJ,CAAS6B,QAA5B;AACApB,gCAAUM,SAAV,CAAoB,EAAExB,KAAK4B,MAAM5B,GAAb,EAApB,EAAwC,EAAE+B,QAAQD,aAAV,EAAxC,EAAmE7D,IAAnE,CAAwE,YACxE;AACIuB,oBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS,MAAV,EAArB;AACH,aAHD;AAIH,SARD;AASH,KAXD,EAYCnB,KAZD,CAYO,eACP;AACIgB,YAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAAEa,SAAS+B,GAAX,EAArB;AACH,KAfD;AAgBH,CAlBD;;AAoBAvD,IAAI8B,IAAJ,CAAS,kBAAT,EAA6BX,UAA7B,EAAyC,UAACC,GAAD,EAAKC,GAAL,EACzC;AACI,QAAMG,UAAUJ,IAAIkB,IAAJ,CAAS8B,WAAzB;AACA5C,YAAQS,SAAR,GAAoBb,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BK,SAAnD;AACAT,YAAQ6C,QAAR,GAAmBjD,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA7C;AACA0C,sBAAQtB,MAAR,CACIxB,OADJ,EAGC1B,IAHD,CAGM,sBACN;AACIuB,YAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAAEa,SAAS+C,UAAX,EAArB;AACH,KAND,EAOClE,KAPD,CAOO,eACP;AACIgB,YAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAAEa,SAAS+B,GAAX,EAArB;AACH,KAVD;AAWH,CAhBD;;AAkBAvD,IAAI8B,IAAJ,CAAS,iBAAT,EAA4BX,UAA5B,EAAwC,UAACC,GAAD,EAAKC,GAAL,EACxC;AACI,QAAGD,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BK,SAAlC,EACA;AACIc,4BAAUf,QAAV,CAAmBZ,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BK,SAAlD,EAA6DnC,IAA7D,CAAkE,iBAClE;AACII,oBAAQsE,GAAR,CAAYf,KAAZ;AACA,2FAA0DA,MAAMR,UAAhE,iBAAsF5D,QAAQC,GAAR,CAAY4C,MAAlG,EACA;AACIC,wBAAO,MADX;AAEIC,yBAAQ,EAAC,6BAA0BhB,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BS,WAArD,EAAoE,UAAS,kBAA7E,EAAgG,gBAAe,kBAA/G,EAFZ;AAGIC,sBAAMC,KAAKC,SAAL,CAAe,EAAC,QAAO,QAAR,EAAiB,SAAQ,EAAC,QAAO,MAAR,EAAgB,SAASpB,IAAIkB,IAAJ,CAASmC,EAAlC,EAAzB,EAAf;AAHV,aADA,EAMC3E,IAND,CAMM,oBACN;AACI,oBAAG4C,SAASC,EAAZ,EACA;AACI,wBAAI+B,cAAcC,qBAAWC,eAAX,CAA2B;AAC7CC,iCAAQ,OADqC;AAE7CC,8BAAM,EAAElD,MAAMvC,QAAQC,GAAR,CAAYyF,QAApB,EAA8BC,MAAM3F,QAAQC,GAAR,CAAY2F,QAAhD;AAFuC,qBAA3B,CAAlB;;AAKA,wBAAIC,cAAc;AACdC,8BAAM9F,QAAQC,GAAR,CAAYyF,QADJ;AAEdK,4BAAIhE,IAAIkB,IAAJ,CAASmC,EAFC;AAGdY,iCAAS,mCAHK;AAIdC,6EACUlE,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+B2D,SADzC,SACsDnE,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+B4D,QADrF,2MAE6CpE,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BK;AAN9D,qBAAlB;;AASAyC,gCAAYe,QAAZ,CAAqBP,WAArB,EAAkC,UAAC3B,GAAD,EAAMmC,IAAN,EAClC;AACI,4BAAGnC,GAAH,EACA;AACIlC,gCAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS+B,GAAV,EAArB;AACH,yBAHD,MAKA;AACIlC,gCAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS,yBAAV,EAArB;AACH;AACJ,qBAVD;AAYH,iBA5BD,MA8BA;AACIH,wBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS,mCAAV,EAArB;AACH;AACJ,aAzCD,EA0CCnB,KA1CD,CA0CO,eACP;AACIgB,oBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS+B,GAAV,EAArB;AACH,aA7CD;AA8CH,SAjDD;AAkDH,KApDD,MAsDA;AACIlC,YAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS,2DAAV,EAArB;AACH;AAEJ,CA5DD;;AA8DAxB,IAAIwD,GAAJ,CAAQ,eAAR,EAAyBrC,UAAzB,EAAqC,UAACC,GAAD,EAAKC,GAAL,EACrC;AACI,QAAGD,IAAIF,OAAJ,CAAYF,QAAf,EACA;AACI,YAAI2E,YAAY,EAAhB;AACA5D,uBAAKC,QAAL,CAAcZ,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BC,GAA7C,EACC/B,IADD,CACM,gBACN;AACI6F,sBAAU/D,IAAV,GAAeA,IAAf;AACA,gBAAGA,KAAKK,SAAR,EACA;AACIc,oCAAUf,QAAV,CAAmBJ,KAAKK,SAAxB,EACCnC,IADD,CACM,iBACN;AACI6F,8BAAU1D,SAAV,GAAsBwB,KAAtB;AACApC,wBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAASmE,SAAV,EAArB;AACH,iBALD;AAMH,aARD,MAUA;AACIA,0BAAU1D,SAAV,GAAsB,IAAtB;AACAZ,oBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAASmE,SAAV,EAArB;AACH;AAEJ,SAnBD;AAoBH,KAvBD,MAyBA;AACItE,YAAIE,MAAJ,CAAW,GAAX;AACH;AAEJ,CA/BD;;AAiCAvB,IAAIwD,GAAJ,CAAQ,kBAAR,EAA4BrC,UAA5B,EAAwC,UAACC,GAAD,EAAKC,GAAL,EACxC;AACI,QAAGD,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BK,SAAlC,EACA;AACI,YAAM4B,SAAS,EAAC5B,WAAWb,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BK,SAA3C,EAAf;AACAqC,0BAAQsB,IAAR,CAAa/B,MAAb,EAAqB/D,IAArB,CAA0B,oBAC1B;AACIuB,gBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAASqE,QAAV,EAArB;AACH,SAHD,EAICxF,KAJD,CAIO,eACP;AACIgB,gBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS+B,GAAV,EAArB;AACH,SAPD;AAQH,KAXD,MAaA;AACIlC,YAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS,iDAAV,EAArB;AACH;AACJ,CAlBD;;AAoBAxB,IAAIwD,GAAJ,CAAQ,6BAAR,EAAuC,UAACpC,GAAD,EAAKC,GAAL,EACvC;AACI0B,wBAAUf,QAAV,CAAmBZ,IAAI0E,MAAJ,CAAWC,OAA9B,EAAuCjG,IAAvC,CAA4C,qBAC5C;AACIuB,YAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqBe,SAArB;AACH,KAHD,EAICrB,KAJD,CAIO,eACP;AACIgB,YAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAAC,WAAW4C,GAAZ,EAArB;AACH,KAPD;AAQH,CAVD;;AAYAvD,IAAIwD,GAAJ,CAAQ,qBAAR,EAA+BrC,UAA/B,EAA2C,UAACC,GAAD,EAAKC,GAAL,EAC3C;AACIU,mBAAKC,QAAL,CAAcZ,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BC,GAA7C,EAAkD/B,IAAlD,CAAuD,gBACvD;AACIiD,4BAAUf,QAAV,CAAmBJ,KAAKK,SAAxB,EAAmCnC,IAAnC,CAAwC,iBACxC;AACIuB,gBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAASiC,KAAV,EAArB;AACH,SAHD;AAIH,KAND,EAOCpD,KAPD,CAOO,eACP;AACIgB,YAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS+B,GAAV,EAArB;AACH,KAVD;AAWH,CAbD;;AAeAvD,IAAIgG,KAAJ,CAAU,+BAAV,EAA2C7E,UAA3C,EAAuD,UAACC,GAAD,EAAKC,GAAL,EACvD;AACIU,mBAAKC,QAAL,CAAcZ,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BC,GAA7C,EAAkD/B,IAAlD,CAAuD,gBACvD;AACI,YAAG8B,KAAKK,SAAR,EACA;AACIZ,gBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS,gEAAV,EAArB;AACH,SAHD,MAKA;AACIuB,gCAAUf,QAAV,CAAmBJ,KAAKK,SAAxB,EAAmC,UAASsB,GAAT,EAAaE,KAAb,EAAoB;AACvD;AACI,wBAAGF,GAAH,EACA;AACIlC,4BAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS,sBAAV,EAArB;AACH,qBAHD,MAKA;AACI,4BAAIyE,iBAAiBxC,MAAMN,OAA3B;AACA8C,uCAAe/B,IAAf,CAAoBtC,IAApB;AACAmB,4CAAUM,SAAV,CAAoB,EAACxB,KAAK4B,MAAM5B,GAAZ,EAApB,EAAwC,EAACsB,SAAS8C,cAAV,EAAxC,EAAmEnG,IAAnE,CAAyE,YACzE;AACIsB,gCAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BK,SAA/B,GAA2CwB,MAAM5B,GAAjD;AACAE,2CAAKsB,SAAL,CAAe,EAACxB,KAAKD,KAAKC,GAAX,EAAf,EAAgC,EAACI,WAAWwB,MAAM5B,GAAlB,EAAhC,EAAwD/B,IAAxD,CAA8D,YAC9D;AACIuB,oCAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAQ,SAAT,EAArB;AACH,6BAHD;AAIH,yBAPD;AAQH;AACJ;AAAC,aAnBF;AAoBH;AACJ,KA7BD;AA+BH,CAjCD;;AAmCAxB,IAAIgG,KAAJ,CAAU,0BAAV,EAAsC7E,UAAtC,EAAkD,UAACC,GAAD,EAAKC,GAAL,EAClD;AACGU,mBAAKC,QAAL,CAAcZ,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BC,GAA7C,EAAkD/B,IAAlD,CAAuD,gBACtD;AACI,YAAG8B,KAAKK,SAAR,EACA;AACIc,gCAAUf,QAAV,CAAmBJ,KAAKK,SAAxB,EAAmCnC,IAAnC,CAAwC,iBACxC;AACI,oBAAIoG,gBAAgBzC,MAAM0C,MAA1B;AACAD,8BAAchC,IAAd,CAAmB9C,IAAIkB,IAAJ,CAAS8D,KAA5B;AACArD,oCAAUM,SAAV,CAAoB,EAAExB,KAAK4B,MAAM5B,GAAb,EAApB,EAAwC,EAAEsE,QAAQD,aAAV,EAAxC,EAAmEpG,IAAnE,CAAyE,YACzE;AACIuB,wBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS0E,aAAV,EAArB;AACH,iBAHD;AAIH,aARD;AASH,SAXD,MAaA;AACI7E,gBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS,0BAAV,EAArB;AACH;AACJ,KAlBF;AAmBF,CArBD;;AAuBAxB,IAAI8B,IAAJ,CAAS,kCAAT,EAA6CX,UAA7C,EAAyD,UAACC,GAAD,EAAKC,GAAL,EACzD;;AAEIgF,YAAQC,GAAR,CAAYC,aAAZ,EAA2BzG,IAA3B,CAAiC,kBAC7B;AACII,gBAAQsE,GAAR,CAAYgC,MAAZ;AACH,KAHL;AAIH,CAPD;;AASAxG,IAAI0D,MAAJ,CAAW,6BAAX,EAAyCvC,UAAzC,EAAoD,UAACC,GAAD,EAAKC,GAAL,EACpD;AACInB,YAAQC,GAAR,CAAYiB,IAAI0E,MAAJ,CAAWC,OAAvB;AACAhD,wBAAUf,QAAV,CAAmBZ,IAAI0E,MAAJ,CAAWC,OAA9B,EAAuCjG,IAAvC,CAA4C,qBAC5C;AACI,YAAG4B,UAAUC,KAAV,IAAmBP,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BC,GAArD,EACA;AACIkB,gCAAU0D,SAAV,CAAoB,EAAC5E,KAAKH,UAAUG,GAAhB,EAApB,EAA0C/B,IAA1C,CAAgD,YAChD;AACIiC,+BAAK2E,UAAL,CAAgB,EAACzE,WAAWP,UAAUG,GAAtB,EAAhB,EAA4C,EAACI,WAAW,IAAZ,EAA5C,EAA+DnC,IAA/D,CAAoE,kBACpE;AACIsB,wBAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAA1B,CAA+BK,SAA/B,GAA2C,IAA3C;AACAqC,sCAAQqC,UAAR,CAAmB,EAAE1E,WAAWb,IAAI0E,MAAJ,CAAWC,OAAxB,EAAnB,EAAsDjG,IAAtD,CAA2D,mBAC3D;AACIuB,4BAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAASJ,IAAIF,OAAJ,CAAYF,QAAZ,CAAqBY,IAArB,CAA0BA,IAApC,EAArB;AACH,qBAHD;AAIH,iBAPD;AAQH,aAVD;AAWH,SAbD,MAeA;AACIP,gBAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS,kDAAV,EAArB;AACH;AAEJ,KArBD,EAsBCnB,KAtBD,CAsBO,eACP;AACIH,gBAAQC,GAAR,CAAYoD,GAAZ;AACAlC,YAAIE,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB,EAACa,SAAS+B,GAAV,EAArB;AACH,KA1BD;AA2BH,CA9BD;;AAgCA;AACAvD,IAAIwD,GAAJ,CAAQ,cAAR,EAAwB,UAACpC,GAAD,EAAKC,GAAL,EAASC,IAAT,EACxB;AAAA,QACWsF,QADX,GACuBxF,IAAIyF,KAD3B,CACWD,QADX;;AAEI,QAAME,QAAQF,WAAWG,OAAO5B,IAAP,CAAYyB,QAAZ,EAAsBI,QAAtB,CAA+B,QAA/B,CAAX,GAAqDC,SAAnE;AACA,QAAMC,gBAAgBlG,mBAASmG,YAAT,CAAsB,QAAtB,EAAgC,EAAEC,OAAM,CAAE,SAAF,EAAY,OAAZ,EAAoB,0CAApB,CAAR,EAA0EN,OAAOA,KAAjF,EAAhC,CAAtB;AACAI,kBAAc9F,GAAd,EAAkBC,GAAlB,EAAsBC,IAAtB;AACH,CAND;;AAQAtB,IAAIwD,GAAJ,CAAQ,gBAAR,EAA0B,UAACpC,GAAD,EAAKC,GAAL,EAC1B;AACID,QAAIF,OAAJ,GAAc,IAAd;AACAE,QAAIiG,MAAJ;AACAhG,QAAIiG,QAAJ,CAAa,GAAb;AACH,CALD;;AAOAtH,IAAIwD,GAAJ,CAAQ,sBAAR,EAA+B,UAACpC,GAAD,EAAKC,GAAL,EAAa;AAACA,QAAIiC,IAAJ,CAAS,iBAAT;AAA4B,CAAzE;AACAtD,IAAIwD,GAAJ,CAAS,wBAAT,EAAmCxC,mBAASmG,YAAT,CAAuB,QAAvB,EAAiC,EAAEI,iBAAiB,sBAAnB,EAAjC,CAAnC,EAAkH,UAACnG,GAAD,EAAMC,GAAN,EAC9G;AACI,QACA;AACI,YAAMyF,QAAS1F,IAAIyF,KAAJ,CAAUC,KAAzB;AACA,YAAMF,WAAWG,OAAO5B,IAAP,CAAY2B,KAAZ,EAAmB,QAAnB,EAA6BE,QAA7B,EAAjB;AACA,YAAI,OAAOJ,QAAP,KAAoB,QAApB,IAAgCA,SAASY,UAAT,CAAoB,GAApB,CAApC,EACA;AACI,mBAAOnG,IAAIiG,QAAJ,CAAaV,QAAb,CAAP;AACH;AACJ,KARD,CASA,OAAOtG,KAAP,EACA;AACI;AACH;AACDe,QAAIiG,QAAJ,CAAa,sBAAb;AACH,CAhBL;;AAmBAtH,IAAIwD,GAAJ,CAAQ,sBAAR,EAA+B,UAACpC,GAAD,EAAKC,GAAL,EAC/B;AACIA,QAAIiG,QAAJ,CAAa,GAAb;AACH,CAHD;AAIAtH,IAAIwD,GAAJ,CAAQ,6BAAR,EAAsC,UAACpC,GAAD,EAAKC,GAAL,EACtC;AACIA,QAAIiC,IAAJ,CAASlC,IAAI0E,MAAJ,CAAWrC,KAApB;AACH,CAHD;;AAKA;AACAzD,IAAIwD,GAAJ,CAAQ,GAAR,EAAa,UAACpC,GAAD,EAAKC,GAAL,EACb;AACIA,QAAIoG,QAAJ,CAAaC,eAAKC,OAAL,CAAa,mBAAb,CAAb;AACH,CAHD","file":"server.js","sourcesContent":["import express from 'express';\nimport bodyParser from 'body-parser';\nimport { ObjectId, ObjectID } from 'mongodb';\nimport SourceMapSupport from 'source-map-support';\nimport passport from 'passport';\nimport cookieSession from 'cookie-session'\nimport path from 'path';\nimport User from '../models/User';\nimport HouseHold from '../models/Household';\nimport Message from '../models/Message';\nimport 'babel-polyfill';\nimport fetch from 'node-fetch';\nimport nodemailer from 'nodemailer';\nrequire('dotenv').config();\nrequire('../passport-setup')\nconst mongoose = require('mongoose');\n\nlet port = process.env.PORT || 3000;\n//app.set('port', (process.env.PORT || 5000));\nSourceMapSupport.install();\n//INITIALIZE DB\nmongoose.connect(`mongodb+srv://JonathanA:${process.env.DBPASSWORD}@roommatecluster.wjtg8.mongodb.net/Roommates?retryWrites=true&w=majority`,{ useNewUrlParser: true, useUnifiedTopology: true })\n.then(connection => \n    {\n        let server = app.listen(port, () => \n        {\n            console.log(`app started on port ${port}`)\n            console.log('Database connected successfully');\n        });\n\n        server.setTimeout(120000);\n    })\n.catch(error => \n    {\n        console.log('ERROR when connecting:', error);\n    });\nconst app = express();\n//MIDDLEWARE\n\napp.use(express.static('static'));\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({extended:false}));\napp.use(cookieSession({\n    name:'Roomies-sesion',\n    keys:['key1','key2']\n}));\napp.use(passport.initialize());\napp.use(passport.session());\n\n\n//ROUTES\nconst isLoggedIn = (req,res,next) =>\n{\n    if(req.session.passport)\n    {\n        next();\n    }\n    else\n    {\n        res.status(401).json({message: 'Route only accessible to logged in users'})\n    }\n}\n\nconst isAuthorized = (houseHold) => \n{\n    if(houseHold.owner === req.session.passport.user.user._id)\n    {\n        return true;\n    }\n    else\n    {\n        return false;\n    }\n}\n\napp.post('/api/v1/households', isLoggedIn, (req,res) => \n{\n    User.findById(req.session.passport.user.user._id).then(user => \n    {\n        if(user.household)\n        {\n            res.status(500).json({message: 'Users are only allowed to be a part of one household at a time'})\n        }\n\n        else\n        {\n            fetch(`https://www.googleapis.com/calendar/v3/calendars?key=${process.env.APIKEY}`, {\n                method:'POST',\n                headers:{'Authorization':`Bearer ${req.session.passport.user.accessToken}`, 'Accept':'application/json','Content-Type':'application/json'},\n                body:JSON.stringify({'summary':req.body.houseName}),\n            })                                                \n            .then(response => \n            {\n                if(response.ok)\n                {\n                    response.json().then(message => \n                    {\n                        const queryFilter = {googleID: req.session.passport.user.user.googleID};\n                        User.findOne(queryFilter).then(user => \n                        {\n                            HouseHold.create({\n                                houseName: JSON.stringify(req.body.houseName),\n                                calendarID: message.id,\n                                owner: user._id,\n                                members: [user,]\n                            })\n                            .then(newHousehold => \n                            {\n                                req.session.passport.user.user.household = newHousehold._id;\n                                User.updateOne(queryFilter, {household:newHousehold._id}).then(update =>\n                                {\n                                    res.status(200).json({ message: newHousehold })\n                                })\n \n                            })\n                        })\n                    }) \n                }\n                else\n                {\n                    res.status(500).send({message: 'Error when creating calendar'});\n                }\n            })\n            .catch(err => \n            {\n                res.status(500).send(err) \n            })\n        }\n    });\n});\n\napp.get('/api/v1/households/public', isLoggedIn, (req,res) => \n{\n    HouseHold.findById(req.session.passport.user.user.household).then(house =>\n    {\n        fetch(`https://www.googleapis.com/calendar/v3/calendars/${house.calendarID}/acl?key=${process.env.APIKEY}`,  \n        {\n            method:'POST',\n            headers:{'Authorization':`Bearer ${req.session.passport.user.accessToken}`, 'Accept':'application/json','Content-Type':'application/json'},\n            body:JSON.stringify({\"role\":\"writer\",\"scope\":{\"type\":\"default\"}}),\n        })\n        .then(response => \n        {\n            if(response.ok)\n            {\n                res.status(200).json({message: 'Success'});\n            }  \n            else\n            {\n                res.status(500).json({message: 'Problem making calendar public'});\n            }\n        })\n        .catch(err => \n        {\n            res.status(500).json({message: err})\n        })\n    })\n})\n\napp.delete('/api/v1/houseHolds/group', isLoggedIn, (req, res) =>\n{\n    User.findById(req.session.passport.user.user._id).then( user =>\n    {\n        HouseHold.findById(user.household).then(house =>\n        \n        {\n            let updatedGroups = house.groups;\n            updatedGroups.filter( ( group, index ) => index == req.body.Index);\n            HouseHold.updateOne( { _id: house._id}, {  } )\n        })\n    })\n})\n\napp.post('/api/v1/events', isLoggedIn, (req,res) => \n{\n    HouseHold.findById(req.session.passport.user.user.household).then(house => \n    {\n        fetch(`https://www.googleapis.com/calendar/v3/calendars/${house.calendarID}/events?key=${process.env.APIKEY}`, {\n            method:'POST',\n            headers:{'Authorization':`Bearer ${req.session.passport.user.accessToken}`, 'Accept':'application/json','Content-Type':'application/json'},\n            body:JSON.stringify(req.body.eventBody),\n        })\n        .then(response => \n        {\n            if(response.ok)\n            {\n                response.json().then(message => \n                {\n                    res.status(200).json({'message':message});\n                })\n                \n            }\n            else\n            {\n                res.status(501).json({message:response.body});\n            }\n        })\n        .catch(err => \n        {\n            res.status(500).json({message: err});\n        })\n    })\n})\n\napp.post('/api/v1/households/groups', isLoggedIn, (req,res) =>\n{\n    User.findById(req.session.passport.user.user._id).then(user =>\n    {\n        HouseHold.findById(user.household).then(house =>\n        {\n            let updatedGroups = house.groups;\n            updatedGroups.push(req.body.newGroup);\n            HouseHold.updateOne({ _id: house._id }, { groups: updatedGroups }).then(() =>\n            {\n                res.status(200).json({message: 'nice'});\n            })\n        })\n    })\n    .catch(err =>\n    {\n        res.status(500).json({ message: err})\n    })\n})\n\napp.post('/api/v1/messages', isLoggedIn, (req,res) => \n{\n    const message = req.body.messageBody;\n    message.household = req.session.passport.user.user.household;\n    message.postedBy = req.session.passport.user.user;\n    Message.create(\n        message\n    )\n    .then(newMessage => \n    {\n        res.status(200).json({ message: newMessage });\n    })\n    .catch(err => \n    {\n        res.status(500).json({ message: err });\n    })\n})\n\napp.post('/api/v1/invite/', isLoggedIn, (req,res) => \n{\n    if(req.session.passport.user.user.household)\n    {\n        HouseHold.findById(req.session.passport.user.user.household).then(house =>\n        {\n            console.dir(house);\n            fetch(`https://www.googleapis.com/calendar/v3/calendars/${house.calendarID}/acl?key=${process.env.APIKEY}`, \n            {\n                method:'POST',\n                headers:{'Authorization':`Bearer ${req.session.passport.user.accessToken}`, 'Accept':'application/json','Content-Type':'application/json'},\n                body: JSON.stringify({\"role\":\"writer\",\"scope\":{\"type\":\"user\", \"value\": req.body.To}}),\n            })\n            .then(response =>\n            {\n                if(response.ok)\n                {\n                    let transporter = nodemailer.createTransport({\n                    service:'gmail',\n                    auth: { user: process.env.MAILUSER, pass: process.env.MAILPASS},\n                    })\n\n                    let mailOptions = {\n                        from: process.env.MAILUSER,\n                        to: req.body.To,\n                        subject: 'Invitation to Room8tes household!',\n                        html: `<p> Hi, \n                                ${req.session.passport.user.user.firstName} ${req.session.passport.user.user.lastName} is inviting to their house. Click here to <a href=\"https://roomies-1.herokuapp.com/auth/google?returnTo=/join\">join </a> </p>\n                                enter this code to join household: ${req.session.passport.user.user.household}`\n                    }   \n\n                    transporter.sendMail(mailOptions, (err, data) => \n                    {\n                        if(err)\n                        {\n                            res.status(500).json({message: err})\n                        }\n                        else\n                        {\n                            res.status(200).json({message: 'Email sent successfully'})\n                        }\n                    })\n\n                }\n                else\n                {\n                    res.status(500).json({message: 'Problem inviting user to calendar'})\n                }\n            })\n            .catch(err => \n            {\n                res.status(500).json({message: err})\n            })\n        })\n    }\n    else\n    {\n        res.status(501).json({message: 'You must create a household before you can invite someone'})\n    }\n\n});\n\napp.get('/api/v1/user/', isLoggedIn, (req,res) => \n{\n    if(req.session.passport)\n    {   \n        let resObject = {};\n        User.findById(req.session.passport.user.user._id)\n        .then(user => \n        {\n            resObject.user=user;\n            if(user.household)\n            {\n                HouseHold.findById(user.household)\n                .then(house => \n                {\n                    resObject.household = house;\n                    res.status(200).json({message: resObject});\n                })\n            }\n            else\n            {\n                resObject.household = null;\n                res.status(200).json({message: resObject});\n            }\n            \n        })\n    }\n    else\n    {\n        res.status(400);\n    }\n\n})\n\napp.get('/api/v1/messages', isLoggedIn, (req,res) => \n{\n    if(req.session.passport.user.user.household)\n    {\n        const filter = {household: req.session.passport.user.user.household}\n        Message.find(filter).then(messages => \n        {\n            res.status(200).json({message: messages})\n        })\n        .catch(err => \n        {\n            res.status(500).json({message: err})\n        })\n    }\n    else\n    {\n        res.status(400).json({message: 'You must join a house to see household messages'})\n    }\n})\n\napp.get('/api/v1/houseHolds/:houseID', (req,res) => \n{\n    HouseHold.findById(req.params.houseID).then(houseHold => \n    {\n        res.status(200).json(houseHold);\n    })\n    .catch(err => \n    {\n        res.status(501).json({'message': err})\n    })\n})\n\napp.get('/api/v1/houseHolds/', isLoggedIn, (req,res) => \n{\n    User.findById(req.session.passport.user.user._id).then(user => \n    {\n        HouseHold.findById(user.household).then(house => \n        {\n            res.status(200).json({message: house});\n        })\n    })\n    .catch(err => \n    {\n        res.status(500).json({message: err})\n    })\n})\n\napp.patch('/api/v1/houseHolds/addMembers', isLoggedIn, (req,res) =>\n{\n    User.findById(req.session.passport.user.user._id).then(user =>\n    {\n        if(user.household)\n        {\n            res.status(500).json({message: 'Users are only allowed to be a part of one household at a time'})\n        }\n        else\n        {\n            HouseHold.findById(user.household, function(err,house) {\n            {\n                if(err)\n                {\n                    res.status(404).json({message: 'Not a valid House Id'});\n                }\n                else\n                {\n                    let updatedMembers = house.members;\n                    updatedMembers.push(user)\n                    HouseHold.updateOne({_id: house._id, }, {members: updatedMembers}).then( () => \n                    {\n                        req.session.passport.user.user.household = house._id;\n                        User.updateOne({_id: user._id}, {household: house._id}).then( () => \n                        {\n                            res.status(200).json({message:'success'});\n                        })\n                    })\n                }\n            }})\n        }\n    })\n    \n})\n\napp.patch('/api/v1/houseHolds/Chore', isLoggedIn, (req,res) =>\n{\n   User.findById(req.session.passport.user.user._id).then(user =>\n    {\n        if(user.household)\n        {\n            HouseHold.findById(user.household).then(house =>\n            {\n                let updatedChores = house.chores;\n                updatedChores.push(req.body.Chore);\n                HouseHold.updateOne({ _id: house._id }, { chores: updatedChores }).then( () =>\n                {\n                    res.status(200).json({message: updatedChores});\n                })\n            })\n        }\n        else\n        {\n            res.status(500).json({message: 'Join house to add chores'})\n        }\n    }) \n})\n\napp.post('/api/v1/househHolds/assignChores', isLoggedIn, (req,res) => \n{\n\n    Promise.all(promisesArray).then( values => \n        {\n            console.dir(values);\n        })\n})\n\napp.delete('/api/v1/houseHolds/:houseID',isLoggedIn,(req,res) => \n{\n    console.log(req.params.houseID);\n    HouseHold.findById(req.params.houseID).then(houseHold => \n    {\n        if(houseHold.owner == req.session.passport.user.user._id)\n        {\n            HouseHold.deleteOne({_id: houseHold._id}).then( () => \n            {\n                User.updateMany({household: houseHold._id}, {household: null}).then(update =>\n                {\n                    req.session.passport.user.user.household = null;\n                    Message.deleteMany({ household: req.params.houseID }).then(deleted=>\n                    {\n                        res.status(200).json({message: req.session.passport.user.user})\n                    })\n                })\n            });\n        }\n        else\n        {\n            res.status(401).json({message: 'Only owner of the house may delete the household'});\n        }\n        \n    })\n    .catch(err => \n    {\n        console.log(err);\n        res.status(500).json({message: err})\n    })\n})\n\n//GOOGLE OAUTH2.0 ROUTES\napp.get('/auth/google', (req,res,next)=>\n{\n    const {returnTo} = req.query;\n    const state = returnTo ? Buffer.from(returnTo).toString('base64'): undefined\n    const authenticator = passport.authenticate('google', { scope:[ 'profile','email','https://www.googleapis.com/auth/calendar',], state: state});\n    authenticator(req,res,next);\n});\n\napp.get('/api/v1/logout', (req,res) =>\n{\n    req.session = null; \n    req.logout();\n    res.redirect('/');\n});\n\napp.get('/auth/google/failure',(req,res) => {res.send('Unable to login')});\napp.get( '/auth/google/callback/', passport.authenticate( 'google', { failureRedirect: '/auth/google/failure' }), (req, res) =>\n    {\n        try\n        {\n            const state  = req.query.state\n            const returnTo = Buffer.from(state, 'base64').toString()\n            if (typeof returnTo === 'string' && returnTo.startsWith('/'))\n            {\n                return res.redirect(returnTo);\n            }\n        }\n        catch (error)\n        {\n            //redirect normally\n        }\n        res.redirect('/auth/google/success')\n    },\n);\n\napp.get('/auth/google/success',(req,res) => \n{\n    res.redirect('/')\n})\napp.get('/auth/google/success/:house',(req,res) => \n{\n    res.send(req.params.house);\n})\n\n//Static page route\napp.get('*', (req,res) =>\n{\n    res.sendFile(path.resolve('static/index.html'));\n});\n\n"]}